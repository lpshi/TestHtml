var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(a,o){function r(t){try{h(n.next(t))}catch(e){o(e)}}function s(t){try{h(n["throw"](t))}catch(e){o(e)}}function h(t){t.done?a(t.value):new i(function(e){e(t.value)}).then(r,s)}h((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(a)throw new TypeError("Generator is already executing.");for(;h;)try{if(a=1,o&&(r=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,o=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(r=h.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){h.label=i[1];break}if(6===i[0]&&h.label<r[1]){h.label=r[1],r=i;break}if(r&&h.label<r[2]){h.label=r[2],h.ops.push(i);break}r[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(n){i=[6,n],o=0}finally{a=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var a,o,r,s,h={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},BaseView=function(t){function e(){var e=t.call(this)||this;return e.deleted=!1,e.isRegister=!1,e.baseName="",e.baseName="keyName_"+MapConfig.BASE_COUNT++,e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemoved,e),e}return __extends(e,t),e.prototype.notificationListeners=function(){return[]},e.prototype.executeNotification=function(t,e){},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),Facade.registerNotifListeners(this),this.loadComplete()},e.prototype.onRemoved=function(t){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoved,this),Facade.removeNotifListeners(this),this.removedComplete()},e.prototype.loadComplete=function(){UpdateManager.addUpdate(this)},e.prototype.removedComplete=function(){UpdateManager.deleteUpdate(this)},e.prototype.update=function(t){},e}(eui.Component);__reflect(BaseView.prototype,"BaseView",["IUpdateable"]);var BaseCommon=function(t){function e(){var e=t.call(this)||this;return e.width=MapConfig.STAGE_WIDTH,e.height=MapConfig.STAGE_HEIGHT,e}return __extends(e,t),e}(BaseView);__reflect(BaseCommon.prototype,"BaseCommon");var ScrollBg=function(t){function e(){var e=t.call(this)||this;e.imgAry=[];for(var i=null,n=0;3>n;++n)e.addChild(i=new eui.Image),e.imgAry.push(i),i.y=MapConfig.MAP_HEIGHT*n;return e.touchEnabled=e.touchChildren=!1,e}return __extends(e,t),e.prototype.updateBgImg=function(t){for(var e=null,i=0;i<this.imgAry.length;++i)e=this.imgAry[i],e.y+=t,e.y>=2*MapConfig.MAP_HEIGHT&&(e.y-=3*MapConfig.MAP_HEIGHT)},e.prototype.setBgRes=function(t){for(var e=0;e<this.imgAry.length;++e)this.imgAry[e].source=t},e.createScrollBg=function(t,i){void 0===i&&(i=null);var n=new e;return t.addChild(n),i&&i.length>0&&n.setBgRes(i),n},e}(eui.Component);__reflect(ScrollBg.prototype,"ScrollBg");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function a(t){e.call(n,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(n))}var r=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(n,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(n,generateEUI2)},r)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var s=t.split("/");s.pop();var h=s.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(n,generateJSON.paths[t])},this):RES.getResByUrl(h,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(n,generateJSON.paths[t])},r)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(n,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,a,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var MapConfig=function(){function t(){}return t.MAP_WIDTH=720,t.MAP_HEIGHT=1280,t.STAGE_WIDTH=720,t.STAGE_HEIGHT=1280,t.BASE_COUNT=1,t.isGamePause=!1,t.Game_Step=5,t}();__reflect(MapConfig.prototype,"MapConfig");var Facade=function(){function t(){}return t.sendNotification=function(t,e){void 0===e&&(e=null);var i=this.notifDic[t];if(i)for(var n in i)i[n].executeNotification(t,e)},t.registerNotifListeners=function(t){if(!t.isRegister){t.isRegister=!0;for(var e=t.notificationListeners(),i=0;i<e.length;++i){var n=this.notifDic[e[i]];n?n.push(t):this.notifDic[e[i]]=[t]}}},t.removeNotifListeners=function(t){t.isRegister=!1;for(var e=t.notificationListeners(),i=0;i<e.length;++i){var n=this.notifDic[e[i]];if(n)for(var a=n.length,o=a;o>=0;o--)n[o].baseName==t.baseName&&n.splice(o,1)}},t.notifDic=new Array,t}();__reflect(Facade.prototype,"Facade");var LayerManager=function(){function t(){}return t.init=function(){UpdateManager.init()},t.initGame=function(e){t.init(),this._baseLayer=e,e.touchEnabled=!1,this._gameLayer=new eui.Component,this._gameLayer.name="gameLayer",e.addChild(this._gameLayer),this._popLayer=new eui.Component,this._popLayer.name="popLayer",e.addChild(this._popLayer),this._tipsLayer=new eui.Component,this._tipsLayer.name="tipsLayer",e.addChild(this._tipsLayer),this._floatingLayer=new eui.Component,this._floatingLayer.name="floatingLayer",this._floatingLayer.width=MapConfig.STAGE_WIDTH,this._floatingLayer.height=MapConfig.STAGE_HEIGHT,e.addChild(this._floatingLayer)},t.addGameLayer=function(e){t._gameLayer.addChild(e)},t.addPopLayer=function(e){t._popLayer.addChild(e)},t.addTipsLayer=function(e){t._tipsLayer.addChild(e)},t.delComp=function(t){t&&t.parent&&t.parent.removeChild(t)},t.removeAddComp=function(e,i,n){n&&n(i),t.delComp(e)},Object.defineProperty(t,"floatingLayer",{get:function(){return t._floatingLayer},enumerable:!0,configurable:!0}),t.doClearTipsChilds=function(){for(;this._tipsLayer.numChildren>0;)this._tipsLayer.removeChildAt(0)},t._gameLayer=null,t._popLayer=null,t._tipsLayer=null,t._floatingLayer=null,t}();__reflect(LayerManager.prototype,"LayerManager");var UpdateManager=function(){function t(){}return t.init=function(){this._lastDelta=egret.getTimer(),egret.startTick(this.update,this)},t.update=function(t){var e=t-this._lastDelta;if(this._lastDelta=t,e>500)return!1;for(var i=this._dicupdateable.length-1;i>=0;i--)this._dicupdateable[i].deleted?this._dicupdateable.splice(i,1):this._dicupdateable[i].update(e);return!1},t.addUpdate=function(t){var e=this._dicupdateable.indexOf(t);t.deleted=!1,-1==e&&this._dicupdateable.push(t)},t.deleteUpdate=function(t){var e=this._dicupdateable.indexOf(t);e>-1&&(this._dicupdateable[e].deleted=!0)},t._dicupdateable=[],t}();__reflect(UpdateManager.prototype,"UpdateManager");var BulletVo=function(){function t(t){this.ID=0,this.resAry=[],this.speed=0,this.nW=0,this.nH=0,this.attackLen=0,this.gapTime=0,this.hitRect=null,this.countAry=[],this.airLv=0,this.ID=+t.ID,this.speed=+t.speed,this.attackLen=+t.attackLen,this.gapTime=+t.gapTime,this.nW=+t.nW,this.nH=+t.nH}return t}();__reflect(BulletVo.prototype,"BulletVo"),window.BulletVo=BulletVo;var BitmapAnimation=function(t){function e(){var e=t.call(this)||this;return e.deleted=!1,e._loop=!0,e._fps=30,e._pause=!1,e._resAry=[],e._passed=0,e._curVal=0,e.touchEnabled=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"loop",{set:function(t){this._loop=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fps",{set:function(t){this._fps=Math.floor(1e3/t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"play",{set:function(t){this._pause=t,this._passed=0,this._curVal=0},enumerable:!0,configurable:!0}),e.prototype.sourceArr=function(t,e){void 0===e&&(e=!0),this._resAry=t,this.play=e,this._resAry&&this._resAry.length>0&&(this.source=this._resAry[0])},e.prototype.setNumSource=function(t,e,i,n,a){void 0===a&&(a="_png");for(var o=[];n>=i;)o.push(e+i+a),i++;this.fps=t,this.sourceArr(o)},e.prototype.update=function(t){this._pause&&this._resAry&&0!=this._resAry.length&&(this._passed+=t,this._passed>this._fps&&(this._curVal+=Math.floor(this._passed/this._fps),this._passed=this._passed%this._fps,this._loop?this.source=this._resAry[this._curVal%this._resAry.length]:this._curVal>=this._resAry.length?(this._pause=!1,this.source=this._resAry[this._resAry.length-1],this.dispatchEventWith(e.LOOP_COMPLETE)):this.source=this._resAry[this._curVal%this._resAry.length]))},e.LOOP_COMPLETE="BitmapAnimation_Loop_Complete",e}(eui.Image);__reflect(BitmapAnimation.prototype,"BitmapAnimation",["IUpdateable"]);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Util=function(){function t(){}return t.anchorOffset=function(t,e,i){t.anchorOffsetX=e,t.anchorOffsetY=i},t}();__reflect(Util.prototype,"Util");var BattleBullet=function(){function t(t){this.bltAry=[],this.bltGroup=t}return t.prototype.careateBullet=function(t,e){e=this.bltGroup.globalToLocal(e.x,e.y);var i=0,n=3,a=30;i-=n%2==0?Math.floor(n/2)*a-a/2:Math.floor(n/2)*a;for(var o=0;3>o;++o){var r=new Bullet(t);this.bltGroup.addChild(r),r.rotation=i+o*a,this.bltAry.push(r),r.x=e.x,r.y=e.y}},t.prototype.updateBullet=function(t){for(var e=this.bltAry.length-1,i=null,n=e;n>=0;--n)i=this.bltAry[n],i.isRemove&&(i.parent.removeChild(i),this.bltAry.splice(n,1))},t}();__reflect(BattleBullet.prototype,"BattleBullet");var BattleCar=function(){function t(t){this.pGroup=null,this.carView=null,this._begin_X=0,this._begin_Y=0,this._status=0,this._bVo=null,this.gapTime=0,this.pGroup=t,t.addChild(this.carView=new CarView),this.carView.x=MapConfig.STAGE_WIDTH>>1,this.carView.y=MapConfig.STAGE_HEIGHT-300,this.carView.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)}return t.prototype.onTouchBegin=function(t){this._status=0,this.pGroup.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.pGroup.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},t.prototype.onTouchMove=function(t){0==this._status?(this._status=1,this._begin_X=t.stageX):2==this._status?(this.carView.x+=t.stageX-this._begin_X,this.carView.x>MapConfig.STAGE_WIDTH-66?this.carView.x=MapConfig.STAGE_WIDTH-66:this.carView.x<66&&(this.carView.x=66),this._begin_X=t.stageX):Math.abs(this._begin_X-t.stageX)>5&&(this._begin_X=t.stageX,this._status=2)},t.prototype.onTouchEnd=function(t){this._status=0,this.pGroup.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.pGroup.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},t.prototype.removedComplete=function(){this.carView.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.pGroup.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.pGroup.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},t.prototype.createBullet=function(t,e){if(this.gapTime-=t,this.gapTime<=0){this.gapTime=this.bVo.gapTime;var i=this.carView.parent.localToGlobal(this.carView.x,this.carView.pointY);e.apply(null,[this.bVo,i])}},Object.defineProperty(t.prototype,"bVo",{get:function(){return this._bVo&&1==this._bVo.ID||(this._bVo=new BulletVo({ID:1,speed:6,gapTime:200,attackLen:400,nW:12,nH:20})),this._bVo},enumerable:!0,configurable:!0}),t}();__reflect(BattleCar.prototype,"BattleCar");var BattleCollision=function(){function t(){}return t.checkUnitHitBullet=function(t,e,i){for(var n=null,a=0;a<i.length;++a)if(n=i[a],!(n.y-100>t))for(var o=null,r=0;r<e.length;++r)o=e[r],Math.abs(o.y-n.y)>150||n.hitRect.intersects(o.hitRect)&&(o.setIsDead(),n.updateHp(-10))},t.checkUnitHitCar=function(t,e){for(var i=null,n=0;n<e.length;++n)if(i=e[n],!(i.y-100>t.y)&&t.hitRect.intersects(i.hitRect)){t.setIsDead(),MapConfig.isGamePause=!0;break}},t}();__reflect(BattleCollision.prototype,"BattleCollision");var BattleUnit=function(){function t(t){this.unitAry=[],this.createY=0,this.pGroup=t}return t.prototype.createUnit=function(t){if(this.createY+=t,this.createY>0){this.createY-=400;var e=new Unit;this.pGroup.addChild(e),this.unitAry.push(e),e.x=66+Math.floor(Math.random()*(MapConfig.STAGE_WIDTH-132)),e.y=-180}},t.prototype.updateUnit=function(t){for(var e=this.unitAry.length-1,i=null,n=e;n>=0;--n)i=this.unitAry[n],i.isRemove&&(i.parent.removeChild(i),this.unitAry.splice(n,1))},t}();__reflect(BattleUnit.prototype,"BattleUnit");var BattleView=function(t){function e(){var e=t.call(this)||this;return e.scrollBg=null,e.battleCar=null,e.battleBullet=null,e.battleUnit=null,e.skinName="BattleSkin",e}return __extends(e,t),e.prototype.loadComplete=function(){this.scrollBg=ScrollBg.createScrollBg(this.groupBg,"bg_1_png"),this.battleBullet=new BattleBullet(this.groupBullet),this.battleCar=new BattleCar(this.groupCar),this.battleUnit=new BattleUnit(this.groupUnit),t.prototype.loadComplete.call(this),MapConfig.isGamePause=!1},e.prototype.removedComplete=function(){t.prototype.removedComplete.call(this),this.battleCar.removedComplete()},e.prototype.update=function(t){var e=this;MapConfig.isGamePause||(this.scrollBg.updateBgImg(MapConfig.Game_Step),this.battleBullet.updateBullet(t),this.battleUnit.updateUnit(t),this.battleCar.createBullet(t,function(t,i){e.battleBullet.careateBullet(t,i)}),this.battleUnit.createUnit(MapConfig.Game_Step),BattleCollision.checkUnitHitBullet(this.battleCar.carView.y,this.battleBullet.bltAry,this.battleUnit.unitAry),BattleCollision.checkUnitHitCar(this.battleCar.carView,this.battleUnit.unitAry))},e}(BaseCommon);__reflect(BattleView.prototype,"BattleView");var Bullet=function(t){function e(e){var i=t.call(this)||this;return i.bitmapAni=null,i.deadAni=null,i.bVo=null,i.nLen=0,i.isDead=!1,i.isRemove=!1,i._hitRect=null,i.bVo=e,i.nLen=e.attackLen,i}return __extends(e,t),Object.defineProperty(e.prototype,"hitRect",{get:function(){return this._hitRect||(this._hitRect=new egret.Rectangle(0,0,this.bVo.nW,this.bVo.nH)),this._hitRect.x=this.x-(this.bVo.nW>>1),this._hitRect.y=this.y-(this.bVo.nH>>1),this._hitRect},enumerable:!0,configurable:!0}),e.prototype.loadComplete=function(){t.prototype.loadComplete.call(this),this.addChild(this.bitmapAni=new BitmapAnimation),this.bitmapAni.setNumSource(1,"common_zidan_",1,1),Util.anchorOffset(this.bitmapAni,this.bVo.nW>>1,this.bVo.nH>>1)},e.prototype.update=function(t){if(this.isDead)return void(this.deadAni&&this.deadAni.update(t));var e=new egret.Point(this.x,this.y);this.x+=this.bVo.speed*Math.cos((this.rotation-90)*Math.PI/180),this.y+=this.bVo.speed*Math.sin((this.rotation-90)*Math.PI/180),this.nLen-=Math.abs(egret.Point.distance(e,new egret.Point(this.x,this.y))),(this.nLen<=0||this.y<=0)&&this.setIsDead(),this.bitmapAni.update(t)},e.prototype.setIsDead=function(){this.isDead||(this.bitmapAni.visible=!1,this.isDead=!0,this.addChild(this.deadAni=new BitmapAnimation),this.deadAni.loop=!1,this.deadAni.addEventListener(BitmapAnimation.LOOP_COMPLETE,this.loopComplete,this),this.deadAni.setNumSource(12,"mztx_",1,3),Util.anchorOffset(this.deadAni,25,25),UpdateManager.addUpdate(this.deadAni))},e.prototype.loopComplete=function(t){this.deadAni&&(UpdateManager.deleteUpdate(this.deadAni),this.deadAni.removeEventListener(BitmapAnimation.LOOP_COMPLETE,this.loopComplete,this),this.deadAni.parent&&this.deadAni.parent.removeChild(this.deadAni),this.deadAni=null),this.isRemove=!0},e.prototype.removedComplete=function(){t.prototype.removedComplete.call(this),this.loopComplete(null),UpdateManager.deleteUpdate(this.bitmapAni)},e}(BaseView);__reflect(Bullet.prototype,"Bullet");var CarView=function(t){function e(){var e=t.call(this)||this;return e.bitmapAni=null,e.shootAni=null,e.deadAni=null,e.isDead=!1,e.isRemove=!1,e._hitRect=null,e}return __extends(e,t),Object.defineProperty(e.prototype,"hitRect",{get:function(){return this._hitRect||(this._hitRect=new egret.Rectangle(0,0,132,150)),this._hitRect.x=this.x-66,this._hitRect.y=this.y-90,this._hitRect},enumerable:!0,configurable:!0}),e.prototype.loadComplete=function(){t.prototype.loadComplete.call(this),this.addChild(this.bitmapAni=new BitmapAnimation),this.bitmapAni.setNumSource(10,"car_",1,4),Util.anchorOffset(this.bitmapAni,this.bitmapAni.width>>1,this.bitmapAni.height>>1),UpdateManager.addUpdate(this.bitmapAni),this.addChild(this.shootAni=new BitmapAnimation),this.shootAni.scaleX=this.shootAni.scaleY=2,this.shootAni.setNumSource(20,"jipuche_huoli_",1,2),Util.anchorOffset(this.shootAni,this.shootAni.width>>1,0),UpdateManager.addUpdate(this.shootAni),this.shootAni.y=-(this.bitmapAni.height>>1)-this.shootAni.height},e.prototype.removedComplete=function(){t.prototype.removedComplete.call(this),UpdateManager.deleteUpdate(this.bitmapAni),UpdateManager.deleteUpdate(this.shootAni),this.loopComplete(null)},e.prototype.setIsDead=function(){this.isDead||(this.bitmapAni.visible=this.shootAni.visible=!1,this.isDead=!0,this.addChild(this.deadAni=new BitmapAnimation),this.deadAni.x=this.deadAni.y=50,this.deadAni.loop=!1,this.deadAni.addEventListener(BitmapAnimation.LOOP_COMPLETE,this.loopComplete,this),this.deadAni.setNumSource(20,"car_dead_",1,7),Util.anchorOffset(this.deadAni,this.deadAni.width>>1,this.deadAni.height>>1),UpdateManager.addUpdate(this.deadAni))},e.prototype.loopComplete=function(t){this.deadAni&&(UpdateManager.deleteUpdate(this.deadAni),this.deadAni.removeEventListener(BitmapAnimation.LOOP_COMPLETE,this.loopComplete,this),this.deadAni.parent&&this.deadAni.parent.removeChild(this.deadAni),this.deadAni=null),this.isRemove=!0},Object.defineProperty(e.prototype,"pointY",{get:function(){return this.y-(this.bitmapAni.height>>1)},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(CarView.prototype,"CarView");var Unit=function(t){function e(){var e=t.call(this)||this;return e.bitmapAni=null,e.deadAni=null,e.isDead=!1,e.isRemove=!1,e.curHp=100,e._hitRect=null,e.skinName="UnitSkin",e}return __extends(e,t),Object.defineProperty(e.prototype,"hitRect",{get:function(){return this._hitRect||(this._hitRect=new egret.Rectangle(0,0,70,70)),this._hitRect.x=this.x-35,this._hitRect.y=this.y-35,this._hitRect},enumerable:!0,configurable:!0}),e.prototype.loadComplete=function(){t.prototype.loadComplete.call(this),this.pGroup.addChildAt(this.bitmapAni=new BitmapAnimation,0),this.bitmapAni.setNumSource(20,"wheel_",1,4),Util.anchorOffset(this,this.pGroup.width>>1,this.pGroup.height>>1),UpdateManager.addUpdate(this.bitmapAni)},e.prototype.removedComplete=function(){t.prototype.removedComplete.call(this),UpdateManager.deleteUpdate(this.bitmapAni),this.loopComplete(null)},e.prototype.update=function(t){return this.isDead?void(this.deadAni&&this.deadAni.update(t)):(this.y+=MapConfig.Game_Step-1,void(this.y>=MapConfig.STAGE_HEIGHT&&this.setIsDead()))},e.prototype.updateHp=function(t){this.isDead||(this.curHp+=t,this.imgHp.width=Math.floor(this.curHp/100*100),this.curHp<=0&&this.setIsDead())},e.prototype.setIsDead=function(){this.isDead||(this.bitmapAni.visible=!1,this.isDead=!0,this.addChild(this.deadAni=new BitmapAnimation),this.deadAni.x=this.deadAni.y=50,this.deadAni.loop=!1,this.deadAni.addEventListener(BitmapAnimation.LOOP_COMPLETE,this.loopComplete,this),this.deadAni.setNumSource(12,"unit_dead_",1,6),Util.anchorOffset(this.deadAni,this.deadAni.width>>1,this.deadAni.height>>1),UpdateManager.addUpdate(this.deadAni))},e.prototype.loopComplete=function(t){this.deadAni&&(this.visible=!1,UpdateManager.deleteUpdate(this.deadAni),this.deadAni.removeEventListener(BitmapAnimation.LOOP_COMPLETE,this.loopComplete,this),this.deadAni.parent&&this.deadAni.parent.removeChild(this.deadAni),this.deadAni=null),this.isRemove=!0},e}(BaseView);__reflect(Unit.prototype,"Unit");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var a=RES.getRes(t);a?n(a):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loadingView=null,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)}),MapConfig.STAGE_WIDTH=this.stage.stageWidth,MapConfig.STAGE_HEIGHT=this.stage.stageHeight},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),this.createGame(),[4,RES.getResAsync("description_json")];case 2:return t=e.sent(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return e.sent(),[4,this.loadTheme()];case 2:return e.sent(),[4,RES.loadGroup("preload",0,this.loadingView)];case 3:return e.sent(),[3,5];case 4:return t=e.sent(),console.error(t),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var n=new eui.Theme("resource/default.thm.json",t.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGame=function(){LayerManager.initGame(this),LayerManager.addGameLayer(new StartView),this.stage.removeChild(this.loadingView)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var StartView=function(t){function e(){var e=t.call(this)||this;return e.skinName="StartSkin",e}return __extends(e,t),e.prototype.loadComplete=function(){t.prototype.loadComplete.call(this),this.btnStartGame.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickTap,this)},e.prototype.removedComplete=function(){t.prototype.removedComplete.call(this),this.btnStartGame.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickTap,this)},e.prototype.onClickTap=function(t){LayerManager.removeAddComp(this,new BattleView,LayerManager.addGameLayer)},e}(BaseCommon);__reflect(StartView.prototype,"StartView");